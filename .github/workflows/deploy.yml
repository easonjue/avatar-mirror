name: Build and Deploy
on: [ push ]
permissions:
  contents: write # æˆäºˆå†™å…¥ä»“åº“å†…å®¹çš„æƒé™ï¼ˆå¿…é¡»ï¼‰
  pages: write # è¡¥å…… Pages éƒ¨ç½²æƒé™ï¼ˆé¿å…éƒ¨ç½²å¤±è´¥ï¼‰
  id-token: write
jobs:
  build-and-deploy:
    concurrency: ci-${{ github.ref }} # é¿å…å¹¶å‘éƒ¨ç½²å†²çª
    runs-on: ubuntu-latest
    steps:
    - name: Checkout ğŸ›ï¸
      uses: actions/checkout@v6
      with:
        fetch-depth: 0 # æ‹‰å–å®Œæ•´æäº¤è®°å½•ï¼ˆå¯é€‰ï¼Œé¿å…æ„å»ºæ—¶ git ä¿¡æ¯ç¼ºå¤±ï¼‰

    - name: Set up Node.js ğŸŸ¢
      uses: actions/setup-node@v4
      with:
        node-version: 20 # æŒ‡å®š Node ç‰ˆæœ¬ï¼ˆé€‚é… Vite è¦æ±‚ï¼‰
        cache: 'npm' # ç¼“å­˜ npm ä¾èµ–ï¼ŒåŠ é€Ÿæ„å»º

    - name: Install and Build ğŸ”§
      run: |
        npm ci # ä¸¥æ ¼å®‰è£… package-lock.json ä¸­çš„ä¾èµ–ï¼ˆæ¯” npm install æ›´ç¨³å®šï¼‰
        npm run build # Vite æ‰“åŒ…å‘½ä»¤ï¼ˆè¾“å‡ºåˆ° dist ç›®å½•ï¼Œè€Œé buildï¼‰
      env:
        # ä¼ é€’ä»“åº“åç»™ Viteï¼Œç¡®ä¿ base è·¯å¾„æ­£ç¡®
        VITE_GITHUB_REPO: ${{ github.event.repository.name }}

    - name: Deploy ğŸš€
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        folder: dist # å…³é”®ï¼Vite é»˜è®¤æ‰“åŒ…è¾“å‡ºåˆ° distï¼Œæ›¿æ¢åŸæ¨¡æ¿çš„ build
        branch: gh-pages # éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯ï¼ˆä¸ªäººä»“åº“å¿…é¡»ï¼‰
        clean: true # éƒ¨ç½²å‰æ¸…ç©º gh-pages åˆ†æ”¯æ—§æ–‡ä»¶ï¼ˆé¿å…ç¼“å­˜ï¼‰
        force: true # å¼ºåˆ¶æ¨é€ï¼ˆè§£å†³åˆ†æ”¯å†²çªï¼‰
        # å¯é€‰ï¼šè‡ªå®šä¹‰æäº¤ä¿¡æ¯
        commit-message: "Deploy: ${{ github.sha }}"
        # ç¦ç”¨ Jekyllï¼ˆé¿å… GitHub è§£æé™æ€æ–‡ä»¶å‡ºé”™ï¼‰
        disable-jekyll: true
