name: Build and Deploy
on: [ push ]
permissions:
  contents: write # æˆäºˆå†™å…¥ä»“åº“å†…å®¹çš„æƒé™ï¼ˆå¿…é¡»ï¼‰
  pages: write # è¡¥å…… Pages éƒ¨ç½²æƒé™ï¼ˆé¿å…éƒ¨ç½²å¤±è´¥ï¼‰
  id-token: write
jobs:
  build-and-deploy:
    concurrency: ci-${{ github.ref }} # é¿å…å¹¶å‘éƒ¨ç½²å†²çª
    runs-on: ubuntu-latest
    steps:
    - name: Checkout ğŸ›ï¸
      uses: actions/checkout@v6
      with:
        fetch-depth: 0 # æ‹‰å–å®Œæ•´æäº¤è®°å½•ï¼ˆå¯é€‰ï¼Œé¿å…æ„å»ºæ—¶ git ä¿¡æ¯ç¼ºå¤±ï¼‰

    - name: Set up Node.js ğŸŸ¢
      uses: actions/setup-node@v4
      with:
        node-version: 20 # æŒ‡å®š Node ç‰ˆæœ¬ï¼ˆé€‚é… Vite è¦æ±‚ï¼‰
        cache: 'pnpm' # æ”¹ä¸ºç¼“å­˜ pnpm ä¾èµ–ï¼ˆå…³é”®ï¼æ›¿æ¢åŸ npm ç¼“å­˜ï¼‰

    - name: Install pnpm ğŸ“¦
      run: |
        # å…¨å±€å®‰è£… pnpmï¼ˆGitHub Actions ç¯å¢ƒé»˜è®¤æ—  pnpmï¼‰
        npm install -g pnpm@8.x # æŒ‡å®šç¨³å®šç‰ˆæœ¬ï¼Œé¿å…å…¼å®¹é—®é¢˜
        # éªŒè¯ pnpm å®‰è£…æˆåŠŸ
        pnpm --version

    - name: Install Dependencies ğŸ”§
      run: |
        # ä¸¥æ ¼æŒ‰ pnpm-lock.yaml å®‰è£…ä¾èµ–ï¼ˆç­‰ä»·äº npm ciï¼‰
        pnpm install --frozen-lockfile
      env:
        # ä¼ é€’ä»“åº“åç»™ Viteï¼Œç¡®ä¿ base è·¯å¾„æ­£ç¡®
        VITE_GITHUB_REPO: ${{ github.event.repository.name }}

    - name: Build Project ğŸ“¦
      run: |
        # æ‰§è¡Œ pnpm æ„å»ºå‘½ä»¤ï¼ˆæ›¿æ¢ npm run buildï¼‰
        pnpm run build

    - name: Deploy ğŸš€
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        folder: dist # å…³é”®ï¼Vite é»˜è®¤æ‰“åŒ…è¾“å‡ºåˆ° dist
        branch: gh-pages # éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯ï¼ˆä¸ªäººä»“åº“å¿…é¡»ï¼‰
        clean: true # éƒ¨ç½²å‰æ¸…ç©º gh-pages åˆ†æ”¯æ—§æ–‡ä»¶ï¼ˆé¿å…ç¼“å­˜ï¼‰
        force: true # å¼ºåˆ¶æ¨é€ï¼ˆè§£å†³åˆ†æ”¯å†²çªï¼‰
        # å¯é€‰ï¼šè‡ªå®šä¹‰æäº¤ä¿¡æ¯
        commit-message: "Deploy: ${{ github.sha }}"
        # ç¦ç”¨ Jekyllï¼ˆé¿å… GitHub è§£æé™æ€æ–‡ä»¶å‡ºé”™ï¼‰
        disable-jekyll: true
